<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>자동 구글 사이트 검색기</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "IBMPlexSansKR-Regular";
        src: url("https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-07@1.0/IBMPlexSansKR-Regular.woff")
          format("woff");
        font-weight: normal;
        font-style: normal;
      }

      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        --hover-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        font-family: "IBMPlexSansKR-Regular";
      }

      .main-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
      }

      .search-card {
        background: white;
        border-radius: 20px;
        box-shadow: var(--card-shadow);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }

      .search-card:hover {
        box-shadow: var(--hover-shadow);
        transform: translateY(-5px);
      }

      .header-icon {
        background: var(--primary-gradient);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        margin: 0 auto 1rem;
      }

      .search-input {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        transform: scale(1.02);
      }

      .btn-search {
        background: var(--primary-gradient);
        border: none;
        border-radius: 15px;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .btn-search:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        color: white;
      }

      .site-checkbox {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .site-checkbox:hover {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .site-checkbox.checked {
        background: linear-gradient(135deg, #667eea15, #764ba215);
        border-color: #667eea;
      }

      .site-checkbox.dragging {
        opacity: 0.5;
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .site-checkbox input[type="checkbox"] {
        margin-right: 0.75rem;
        transform: scale(1.2);
      }

      .drag-handle {
        color: #6c757d;
        cursor: grab;
        padding: 0 0.5rem;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .drag-handle:active {
        cursor: grabbing;
      }

      .site-checkbox:hover .drag-handle {
        opacity: 1;
      }

      .btn-remove {
        background: none;
        border: none;
        color: #dc3545;
        opacity: 0;
        transition: all 0.3s ease;
      }

      .site-checkbox:hover .btn-remove {
        opacity: 1;
      }

      .btn-remove:hover {
        color: #c82333;
        transform: scale(1.1);
      }

      .add-site-section {
        background: white;
        border-radius: 20px;
        box-shadow: var(--card-shadow);
        padding: 1.5rem;
        margin-bottom: 2rem;
      }

      .btn-add {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-add:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        color: white;
      }

      .select-all-controls {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        margin-bottom: 1rem;
      }

      .btn-control {
        background: none;
        border: 1px solid #6c757d;
        border-radius: 8px;
        padding: 0.375rem 0.75rem;
        margin-right: 0.5rem;
        color: #6c757d;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .btn-control:hover {
        background: #6c757d;
        color: white;
      }

      .btn-control.btn-danger {
        border-color: #dc3545;
        color: #dc3545;
      }

      .btn-control.btn-danger:hover {
        background: #dc3545;
        color: white;
      }

      .btn-toggle-select {
        background: none;
        border: 1px solid #667eea;
        border-radius: 8px;
        padding: 0.375rem 0.75rem;
        margin-right: 0.5rem;
        color: #667eea;
        font-size: 0.875rem;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .btn-toggle-select:hover {
        background: #667eea;
        color: white;
      }

      .search-stats {
        background: linear-gradient(135deg, #17a2b8, #6f42c1);
        color: white;
        border-radius: 10px;
        padding: 1rem;
        margin-top: 1rem;
        text-align: center;
      }

      .drop-zone {
        border: 2px dashed #667eea;
        border-radius: 10px;
        padding: 1rem;
        margin: 0.25rem 0;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .drop-zone.active {
        opacity: 1;
        background: rgba(102, 126, 234, 0.1);
      }

      @media (max-width: 768px) {
        .main-container {
          padding: 1rem;
        }

        .search-card {
          padding: 1.5rem;
        }

        .btn-control {
          margin-bottom: 0.25rem;
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- 메인 검색 카드 -->
      <div class="search-card fade-in">
        <div class="header-icon">
          <i class="fas fa-search"></i>
        </div>
        <h2 class="text-center mb-4">자동 구글 사이트 검색기</h2>

        <form id="searchForm">
          <div class="mb-4">
            <div class="input-group">
              <span class="input-group-text bg-light border-0">
                <i class="fas fa-search text-muted"></i>
              </span>
              <input
                type="text"
                id="query"
                class="form-control search-input border-start-0"
                placeholder="검색어를 입력하세요..."
                required
              />
            </div>
          </div>

          <!-- 사이트 선택 섹션 -->
          <div class="mb-4">
            <label class="form-label fw-bold text-primary mb-3">
              <i class="fas fa-globe me-2"></i>검색할 사이트 선택
            </label>

            <!-- 전체 선택/해제 컨트롤 -->
            <div class="select-all-controls">
              <button
                type="button"
                class="btn-toggle-select"
                id="toggleSelectBtn"
                onclick="toggleSelectAll()"
              >
                <i class="fas fa-check-double me-1"></i>전체 선택
              </button>
              <button
                type="button"
                class="btn-control btn-danger"
                onclick="deleteAllSites()"
              >
                <i class="fas fa-trash-alt me-1"></i>전체 삭제
              </button>
              <span class="ms-auto text-muted d-block d-md-inline mt-2 mt-md-0" id="selectedCount"
                >선택된 사이트: 0개</span
              >
            </div>

            <div id="siteList"></div>
          </div>

          <div class="text-center">
            <button type="submit" class="btn btn-search btn-lg">
              <i class="fas fa-search me-2"></i>검색하기
            </button>
          </div>
        </form>

        <!-- 검색 통계 -->
        <div class="search-stats" id="searchStats" style="display: none">
          <i class="fas fa-chart-bar me-2"></i>
          <span id="statsText"></span>
        </div>
      </div>

      <!-- 사이트 추가 섹션 -->
      <div class="add-site-section fade-in">
        <h5 class="mb-3">
          <i class="fas fa-plus-circle text-success me-2"></i>새 사이트 추가
        </h5>
        <div class="input-group">
          <span class="input-group-text bg-light">
            <i class="fas fa-globe text-muted"></i>
          </span>
          <input
            type="text"
            id="newSite"
            class="form-control"
            placeholder="예: stackoverflow.com"
          />
          <button type="button" class="btn btn-add" onclick="addSite()">
            <i class="fas fa-plus me-1"></i>추가
          </button>
        </div>
        <small class="text-muted mt-2 d-block">
          <i class="fas fa-info-circle me-1"></i>
          도메인만 입력하세요 (예: naver.com, github.com) | 드래그하여 순서 변경 가능
        </small>
      </div>

      <center>
        Made with ❤️ in <a href="https://github.com/seongpark">SEONG Park</a>
      </center>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      const siteListContainer = document.getElementById("siteList");
      const STORAGE_KEY = "customSites";
      let draggedElement = null;
      let draggedIndex = null;

      // 기본 사이트들을 더 유용한 것들로 업데이트
      const defaultSites = [
        "stackoverflow.com",
        "github.com",
        "medium.com",
        "wikipedia.org",
        "reddit.com",
        "youtube.com",
      ];

      function getStoredSites() {
        const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
        return stored ? stored : defaultSites;
      }

      function saveSites(sites) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(sites));
      }

      function renderSiteList() {
        const sites = getStoredSites();
        siteListContainer.innerHTML = "";

        if (sites.length === 0) {
          siteListContainer.innerHTML = `
            <div class="text-center text-muted py-4">
              <i class="fas fa-globe fa-2x mb-3"></i>
              <p>등록된 사이트가 없습니다.</p>
              <p>아래에서 새 사이트를 추가해주세요.</p>
            </div>
          `;
          updateSelectedCount();
          updateToggleButton();
          return;
        }

        sites.forEach((site, index) => {
          const siteDiv = document.createElement("div");
          siteDiv.className = "site-checkbox";
          siteDiv.draggable = true;
          siteDiv.innerHTML = `
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center flex-grow-1">
                <span class="drag-handle">
                  <i class="fas fa-grip-vertical"></i>
                </span>
                <label class="flex-grow-1 mb-0 cursor-pointer">
                  <input type="checkbox" name="site" value="${site}" 
                         onchange="updateSelectedCount(); updateCheckboxStyle(this); updateToggleButton();">
                  <span class="fw-medium">${site}</span>
                </label>
              </div>
              <button type="button" class="btn-remove" onclick="removeSite('${site}')" 
                      title="사이트 제거">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          `;

          // 드래그 이벤트 리스너 추가
          siteDiv.addEventListener('dragstart', handleDragStart);
          siteDiv.addEventListener('dragover', handleDragOver);
          siteDiv.addEventListener('drop', handleDrop);
          siteDiv.addEventListener('dragend', handleDragEnd);

          siteListContainer.appendChild(siteDiv);
        });

        updateSelectedCount();
        updateToggleButton();
      }

      function handleDragStart(e) {
        draggedElement = e.target;
        draggedIndex = Array.from(siteListContainer.children).indexOf(draggedElement);
        draggedElement.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      }

      function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
      }

      function handleDrop(e) {
        e.preventDefault();
        if (draggedElement !== e.target.closest('.site-checkbox')) {
          const dropTarget = e.target.closest('.site-checkbox');
          const dropIndex = Array.from(siteListContainer.children).indexOf(dropTarget);
          
          if (dropIndex !== -1 && draggedIndex !== dropIndex) {
            const sites = getStoredSites();
            const movedSite = sites.splice(draggedIndex, 1)[0];
            sites.splice(dropIndex, 0, movedSite);
            saveSites(sites);
            renderSiteList();
            showAlert(`사이트 순서가 변경되었습니다.`, "success");
          }
        }
      }

      function handleDragEnd(e) {
        if (draggedElement) {
          draggedElement.classList.remove('dragging');
        }
        draggedElement = null;
        draggedIndex = null;
      }

      function updateCheckboxStyle(checkbox) {
        const siteDiv = checkbox.closest(".site-checkbox");
        if (checkbox.checked) {
          siteDiv.classList.add("checked");
        } else {
          siteDiv.classList.remove("checked");
        }
      }

      function updateSelectedCount() {
        const checkedSites = document.querySelectorAll(
          'input[name="site"]:checked',
        );
        const count = checkedSites.length;
        document.getElementById("selectedCount").textContent =
          `선택된 사이트: ${count}개`;
      }

      function updateToggleButton() {
        const checkboxes = document.querySelectorAll('input[name="site"]');
        const checkedBoxes = document.querySelectorAll('input[name="site"]:checked');
        const toggleBtn = document.getElementById("toggleSelectBtn");
        
        if (checkboxes.length === 0) {
          toggleBtn.disabled = true;
          toggleBtn.innerHTML = '<i class="fas fa-check-double me-1"></i>전체 선택';
          return;
        }
        
        toggleBtn.disabled = false;
        
        if (checkedBoxes.length === checkboxes.length && checkboxes.length > 0) {
          toggleBtn.innerHTML = '<i class="fas fa-times me-1"></i>전체 해제';
        } else {
          toggleBtn.innerHTML = '<i class="fas fa-check-double me-1"></i>전체 선택';
        }
      }

      function toggleSelectAll() {
        const checkboxes = document.querySelectorAll('input[name="site"]');
        const checkedBoxes = document.querySelectorAll('input[name="site"]:checked');
        const shouldCheck = checkedBoxes.length !== checkboxes.length;
        
        checkboxes.forEach((cb) => {
          cb.checked = shouldCheck;
          updateCheckboxStyle(cb);
        });
        
        updateSelectedCount();
        updateToggleButton();
      }

      function deleteAllSites() {
        const sites = getStoredSites();
        if (sites.length === 0) {
          showAlert("삭제할 사이트가 없습니다.", "info");
          return;
        }

        if (confirm(`등록된 모든 사이트(${sites.length}개)를 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`)) {
          saveSites([]);
          renderSiteList();
          showAlert("모든 사이트가 삭제되었습니다.", "success");
        }
      }

      function addSite() {
        const input = document.getElementById("newSite");
        let newSite = input.value.trim();

        // 프로토콜 제거 및 도메인 정리
        newSite = newSite.replace(/^https?:\/\//, "").replace(/\/$/, "");

        if (!newSite) {
          showAlert("사이트 주소를 입력해주세요.", "warning");
          return;
        }

        // 도메인 유효성 검사
        const domainPattern =
          /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}$/;
        if (!domainPattern.test(newSite)) {
          showAlert(
            "올바른 도메인 형식을 입력해주세요. (예: example.com)",
            "warning",
          );
          return;
        }

        const sites = getStoredSites();
        if (sites.includes(newSite)) {
          showAlert("이미 존재하는 사이트입니다.", "info");
          return;
        }

        const updated = [...sites, newSite];
        saveSites(updated);
        renderSiteList();
        input.value = "";
        showAlert(`${newSite}이(가) 추가되었습니다!`, "success");
      }

      function removeSite(siteToRemove) {
        if (confirm(`'${siteToRemove}'을(를) 삭제하시겠습니까?`)) {
          const updated = getStoredSites().filter(
            (site) => site !== siteToRemove,
          );
          saveSites(updated);
          renderSiteList();
          showAlert("사이트가 삭제되었습니다.", "info");
        }
      }

      function showAlert(message, type = "info") {
        // 부트스트랩 토스트 알림 생성
        const toastContainer =
          document.getElementById("toastContainer") || createToastContainer();
        const toastId = "toast_" + Date.now();

        const toast = document.createElement("div");
        toast.id = toastId;
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute("role", "alert");
        toast.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" 
                    data-bs-dismiss="toast"></button>
          </div>
        `;

        toastContainer.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();

        // 토스트가 사라진 후 DOM에서 제거
        toast.addEventListener("hidden.bs.toast", () => {
          toast.remove();
        });
      }

      function createToastContainer() {
        const container = document.createElement("div");
        container.id = "toastContainer";
        container.className =
          "toast-container position-fixed bottom-0 end-0 p-3";
        document.body.appendChild(container);
        return container;
      }

      // 폼 제출 처리
      document
        .getElementById("searchForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const query = document.getElementById("query").value.trim();
          const checkedSites = document.querySelectorAll(
            'input[name="site"]:checked',
          );
          const sites = Array.from(checkedSites).map(
            (cb) => `site:${cb.value}`,
          );

          if (!query) {
            showAlert("검색어를 입력해주세요.", "warning");
            document.getElementById("query").focus();
            return;
          }

          if (sites.length === 0) {
            showAlert("검색할 사이트를 최소 1개 이상 선택해주세요.", "warning");
            return;
          }

          const fullQuery = `${sites.join(" OR ")} ${query}`;
          const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(fullQuery)}`;

          // 검색 통계 표시
          const statsDiv = document.getElementById("searchStats");
          const statsText = document.getElementById("statsText");
          statsText.textContent = `"${query}" 키워드로 ${sites.length}개 사이트에서 검색 중...`;
          statsDiv.style.display = "block";

          // 검색 실행
          window.open(googleUrl, "_blank");

          showAlert("새 탭에서 검색 결과를 확인하세요!", "success");

          setTimeout(() => {
            statsDiv.style.display = "none";
          }, 3000);
        });

      // Enter 키로 사이트 추가
      document
        .getElementById("newSite")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            addSite();
          }
        });

      // 초기화
      renderSiteList();

      // 첫 번째 사이트 자동 선택 (UX 개선)
      setTimeout(() => {
        const firstCheckbox = document.querySelector('input[name="site"]');
        if (firstCheckbox) {
          firstCheckbox.checked = true;
          updateCheckboxStyle(firstCheckbox);
          updateSelectedCount();
          updateToggleButton();
        }
      }, 100);
    </script>
  </body>
</html>
